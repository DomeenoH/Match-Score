import{j as e,c as j,a as y,d as g,Q as N}from"./Questionnaire.Ckc3EZl4.js";import{r as b}from"./index.CVf8TyFT.js";function w({onMatch:n}){const[x,a]=b.useState(""),d=s=>{const l=s.match(/[?&]host=([a-zA-Z0-9\-_]+)/);if(l&&l[1])return l[1];const i=s.split(/[\s\n\r]+/).filter(o=>/^[a-zA-Z0-9\-_]{10,}$/.test(o));if(i.length>0){const o=i.filter(u=>!u.startsWith("http"));return o.length>0?o[o.length-1]:i[i.length-1]}return s.trim()},t=s=>{s.preventDefault();const l=x.trim();if(l){const m=d(l);n(m)}},r=s=>{s.preventDefault();const l=s.clipboardData.getData("text");a(l);const m=d(l);m!==l&&m.length>0?a(m):a(l)};return e.jsxs("div",{className:"max-w-md mx-auto p-8 bg-white rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"è¾“å…¥å¯¹æ–¹çš„ Soul Hash"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"ç²˜è´´é‚€è¯·å‡½ã€é“¾æ¥æˆ–ç›´æ¥è¾“å…¥ Hash ç¼–ç "})]}),e.jsxs("form",{onSubmit:t,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hash-input",className:"sr-only",children:"Soul Hash"}),e.jsx("textarea",{id:"hash-input",value:x,onChange:s=>a(s.target.value),onPaste:r,placeholder:"åœ¨æ­¤ç²˜è´´...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent transition-all min-h-[120px] text-sm font-mono resize-none",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full px-6 py-4 bg-black text-white font-bold rounded-xl hover:bg-gray-800 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:"å¼€å§‹åŒ¹é…åˆ†æ"})]})]})}function v({result:n,hostInfo:x,guestInfo:a}){const d=(o,u,h)=>{const c=o.indexOf(u);if(c===-1)return null;let f="";if(h){const p=o.indexOf(h);p!==-1?f=o.substring(c+u.length,p).trim():f=o.substring(c+u.length).trim()}else f=o.substring(c+u.length).trim();return f.replace(/^[:ï¼š\n\(\)ï¼ˆï¼‰]+/,"").trim()},t=n.details,r=d(t,"1. æ ¸å¿ƒç»“è®º","2. å…³é”®ä¼˜åŠ¿åˆ†æ")||"æš‚æ— ç»“è®º",s=d(t,"2. å…³é”®ä¼˜åŠ¿åˆ†æ","3. æ½œåœ¨é›·åŒºé¢„è­¦"),l=d(t,"3. æ½œåœ¨é›·åŒºé¢„è­¦","4. é•¿æœŸç›¸å¤„å»ºè®®"),m=d(t,"4. é•¿æœŸç›¸å¤„å»ºè®®"),i=o=>o?e.jsx("ul",{className:"space-y-3",children:o.split(`
`).map((u,h)=>{const c=u.trim();return!c||c.startsWith("---")?null:e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 mt-1.5 h-1.5 w-1.5 flex-shrink-0 rounded-full bg-current opacity-60"}),e.jsx("span",{className:"text-sm leading-relaxed",children:c.replace(/^- /,"").replace(/^\d+\. /,"")})]},h)})}):e.jsx("p",{className:"text-gray-500 italic",children:"æš‚æ— æ˜¾è‘—æ•°æ®"});return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 sm:p-10 bg-white border border-gray-200 rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 text-xs font-mono text-gray-400 border-b border-gray-100 pb-4",children:[e.jsxs("div",{children:["å‘èµ·è€…(A): ",x||"Unknown"]}),e.jsxs("div",{children:["åŒ¹é…è€…(B): ",a||"Unknown"]})]}),e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 mb-2",children:"çµé­‚å¥‘åˆåº¦åˆ†ææŠ¥å‘Š"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"åŸºäº 50 ç»´åº¦æ·±åº¦æ¯”å¯¹ç®—æ³•"}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-8 relative",children:e.jsxs("div",{className:"relative w-40 h-40 flex items-center justify-center",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"#f3f4f6",strokeWidth:"12",fill:"transparent"}),e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"currentColor",strokeWidth:"12",fill:"transparent",strokeDasharray:440,strokeDashoffset:440-440*n.compatibilityScore/100,className:"text-black transition-all duration-1000 ease-out",strokeLinecap:"round"})]}),e.jsxs("div",{className:"absolute flex flex-col items-center",children:[e.jsxs("span",{className:"text-4xl font-black tracking-tighter",children:[n.compatibilityScore,"%"]}),e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mt-1",children:"Match"})]})]})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-900 text-white p-8 rounded-xl shadow-lg transform hover:scale-[1.01] transition-transform",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ğŸ’¡"})," æ ¸å¿ƒç»“è®º"]}),e.jsx("p",{className:"text-lg leading-relaxed font-medium opacity-90",children:r})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-green-50 p-6 rounded-xl border border-green-100",children:[e.jsxs("h3",{className:"text-green-800 font-bold mb-4 flex items-center",children:[e.jsx("span",{className:"bg-green-200 text-green-800 p-1 rounded mr-2 text-xs",children:"MATCH"}),"å…³é”®ä¼˜åŠ¿"]}),e.jsx("div",{className:"text-green-900",children:i(s)})]}),e.jsxs("div",{className:"bg-red-50 p-6 rounded-xl border border-red-100",children:[e.jsxs("h3",{className:"text-red-800 font-bold mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-200 text-red-800 p-1 rounded mr-2 text-xs",children:"CONFLICT"}),"æ½œåœ¨é›·åŒº"]}),e.jsx("div",{className:"text-red-900",children:i(l)})]})]}),e.jsxs("div",{className:"bg-blue-50 p-8 rounded-xl border border-blue-100",children:[e.jsx("h3",{className:"text-blue-900 font-bold mb-4",children:"ğŸ”® é•¿æœŸç›¸å¤„å»ºè®®"}),e.jsx("div",{className:"text-blue-800 leading-relaxed",children:i(m)})]})]}),e.jsx("div",{className:"mt-12 text-center",children:e.jsx("button",{onClick:()=>window.location.href="/",className:"px-8 py-3 bg-white border-2 border-black text-black font-bold rounded-lg hover:bg-gray-50 transition-colors",children:"è¿”å›é¦–é¡µ"})})]})}const S=(n,x)=>{const a=j(n,x),d=y.map((t,r)=>{const s=n.answers[r],l=x.answers[r],m=t.options.find(o=>o.value===s),i=t.options.find(o=>o.value===l);return{id:t.id,dimension:t.dimension,question:t.text,A_answer:s,B_answer:l,A_label:m?.label||"N/A",B_label:i?.label||"N/A",difference:Math.abs(s-l)}});return{hostProfile:n,guestProfile:x,matchScore:a,comparisonMatrix:d}},A=n=>{const{matchScore:x,comparisonMatrix:a}=n,d=a.filter(s=>s.difference<=1),t=a.filter(s=>s.difference>=3);let r=`ä½ æ˜¯ä¸€ä½é¡¶å°–çš„ã€ä»¥æ•°æ®é©±åŠ¨çš„â€œå…³ç³»ç¤¾ä¼šå­¦å®¶â€ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸¤ä¸ªäººçš„50ä¸ªç»´åº¦é—®å·ç»“æœï¼Œç”Ÿæˆä¸€ä»½å®¢è§‚ã€çŠ€åˆ©ã€ç»“æ„åŒ–çš„ç›¸æ€§åˆ†ææŠ¥å‘Šã€‚ä¸¤äººåŸºç¡€åŒ¹é…åº¦ä¸º ${x}%ã€‚è¯·ä»ä¸‰ä¸ªç»´åº¦ï¼ˆä¼˜åŠ¿ã€é›·åŒºã€é•¿æœŸå»ºè®®ï¼‰åˆ†æï¼Œå¹¶ä½¿ç”¨ä¸­æ–‡åˆ†ç‚¹ä½œç­”ã€‚`;return r+=`

--- ä¼˜åŠ¿ç»´åº¦ï¼ˆDifference <= 1ï¼‰ï¼šä¸¤äººå¤©ç„¶å¥‘åˆç‚¹ ---`,d.slice(0,5).forEach(s=>{r+=`
- [${s.dimension}]: Q.${s.id} (${s.question}) ä¸¤äººç­”æ¡ˆå‡ ä¹ä¸€è‡´ï¼ŒA: ${s.A_label}, B: ${s.B_label}ã€‚`}),r+=`

--- æ ¸å¿ƒé›·åŒºï¼ˆDifference >= 3ï¼‰ï¼šæœªæ¥æ½œåœ¨çš„å†²çªçˆ†å‘ç‚¹ ---`,t.slice(0,5).forEach(s=>{r+=`
- [${s.dimension}]: Q.${s.id} (${s.question}) å·®å¼‚å·¨å¤§ (A:${s.A_label} vs B:${s.B_label})ã€‚è¿™æ˜¯ç¡¬æ€§çŸ›ç›¾ï¼Œéœ€è¦æ·±å…¥å…³æ³¨ã€‚`}),r+=`

--- ç»´åº¦æ€»ç»“ ---`,r+=`

è¯·æ ¹æ®ä¸Šè¿°æ•°æ®å’Œé£æ ¼è¦æ±‚ï¼Œç”ŸæˆæŠ¥å‘Šçš„æœ€ç»ˆå†…å®¹ï¼ŒæŠ¥å‘Šåº”åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š
`,r+=`1. æ ¸å¿ƒç»“è®ºï¼ˆä¸€å¥è¯æ€»ç»“ï¼Œç›´æŒ‡æœ¬è´¨ï¼‰
`,r+=`2. å…³é”®ä¼˜åŠ¿åˆ†æï¼ˆåˆ—ç‚¹é˜è¿°ï¼‰
`,r+=`3. æ½œåœ¨é›·åŒºé¢„è­¦ï¼ˆåˆ—ç‚¹é˜è¿°ï¼Œè¯­è¨€è¦çŠ€åˆ©ï¼‰
`,r+=`4. é•¿æœŸç›¸å¤„å»ºè®®ï¼ˆç»™å‡ºå¯æ“ä½œçš„ç­–ç•¥ï¼‰
`,r},k=async(n,x)=>{const a=S(n,x),d=A(a);try{const t=await fetch("/api/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:d})});if(!t.ok)throw new Error("AI Analysis request failed");const r=await t.json();return{compatibilityScore:a.matchScore,summary:`åŸºäºæ•°æ®çš„çµé­‚å¥‘åˆåº¦ï¼š${a.matchScore}%`,details:r.reportText}}catch(t){return console.error("AI Analysis Error:",t),{compatibilityScore:a.matchScore,summary:`åŸºäºæ•°æ®çš„çµé­‚å¥‘åˆåº¦ï¼š${a.matchScore}% (ç¦»çº¿æ¨¡å¼)`,details:`[ç³»ç»Ÿæç¤ºï¼šAI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œä»¥ä¸‹æ˜¯åŸºäºåŸå§‹æ•°æ®çš„åˆ†æé¢„è§ˆ]

${d}`}}};function $(){const[n,x]=b.useState(null),[a,d]=b.useState(null),[t,r]=b.useState(null),[s,l]=b.useState(!1),[m,i]=b.useState(null);b.useEffect(()=>{const c=new URLSearchParams(window.location.search).get("host");c&&(g(c)?x(c):i("æ— æ•ˆçš„é‚€è¯·é“¾æ¥æˆ– Soul Hash å·²æŸåã€‚"))},[]);const o=h=>{g(h)?(x(h),window.history.pushState({},"",`/match?host=${h}`),i(null)):i("æ— æ•ˆçš„ Soul Hashï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚")},u=async h=>{d(h),l(!0),i(null);try{if(n){const c=g(n),f=g(h);if(c&&f){const p=await k(c,f);r(p)}else i("è§£æ Soul Profile å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚")}}catch(c){console.error(c),i("åˆ†æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚")}finally{l(!1)}};return t?e.jsx(v,{result:t,hostInfo:n?n.substring(0,8)+"...":void 0,guestInfo:a?a.substring(0,8)+"...":void 0}):s?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-black mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"æ­£åœ¨è¿›è¡Œçµé­‚å…±é¸£åˆ†æ..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"AI æ­£åœ¨å¯¹æ¯”ä½ ä»¬çš„ 50 ä¸ªç»´åº¦æ•°æ®"})]}):m?e.jsxs("div",{className:"max-w-md mx-auto mt-10 p-6 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"å‡ºé”™äº†"}),e.jsx("p",{className:"text-red-600 mb-4",children:m}),e.jsx("button",{onClick:()=>window.location.href="/match",className:"px-4 py-2 bg-white border border-red-300 text-red-700 rounded hover:bg-red-50 transition-colors",children:"è¿”å›é‡è¯•"})]}):n?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center bg-gray-50 p-6 rounded-xl border border-gray-100",children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-black text-white rounded-full text-xs font-mono mb-3",children:"åŒ¹é…æ¨¡å¼ (MATCHING MODE)"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"å¯¹æ–¹å·²å°±ä½ï¼Œè¯·å®Œæˆä½ çš„ Soul Profile"}),e.jsxs("p",{className:"text-gray-500 text-sm font-mono",children:["ç›®æ ‡ Hash: ",n.substring(0,12),"..."]})]}),e.jsx(N,{onComplete:u})]}):e.jsx(w,{onMatch:o})}export{$ as default};
