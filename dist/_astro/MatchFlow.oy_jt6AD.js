import{j as e,c as w,a as v,d as g,Q as S}from"./Questionnaire.Ckc3EZl4.js";import{r as p}from"./index.CVf8TyFT.js";function A({onMatch:l}){const[h,c]=p.useState(""),i=t=>{const r=t.match(/[?&]host=([a-zA-Z0-9\-_]+)/);if(r&&r[1])return r[1];const a=t.split(/[\s\n\r]+/).filter(s=>/^[a-zA-Z0-9\-_]{10,}$/.test(s));if(a.length>0){const s=a.filter(d=>!d.startsWith("http"));return s.length>0?s[s.length-1]:a[a.length-1]}return t.trim()},o=t=>{t.preventDefault();const r=h.trim();if(r){const u=i(r);l(u)}},n=t=>{t.preventDefault();const r=t.clipboardData.getData("text");c(r);const u=i(r);u!==r&&u.length>0?c(u):c(r)};return e.jsxs("div",{className:"max-w-md mx-auto p-8 bg-white rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"è¾“å…¥å¯¹æ–¹çš„ Soul Hash"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"ç²˜è´´é‚€è¯·å‡½ã€é“¾æ¥æˆ–ç›´æ¥è¾“å…¥ Hash ç¼–ç "})]}),e.jsxs("form",{onSubmit:o,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hash-input",className:"sr-only",children:"Soul Hash"}),e.jsx("textarea",{id:"hash-input",value:h,onChange:t=>c(t.target.value),onPaste:n,placeholder:"åœ¨æ­¤ç²˜è´´...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent transition-all min-h-[120px] text-sm font-mono resize-none",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full px-6 py-4 bg-black text-white font-bold rounded-xl hover:bg-gray-800 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:"å¼€å§‹åŒ¹é…åˆ†æ"})]})]})}function k({result:l,hostInfo:h,guestInfo:c}){const i=(s,d,b)=>{const m=s.indexOf(d);if(m===-1)return null;let x="";if(b){const f=s.indexOf(b);f!==-1?x=s.substring(m+d.length,f).trim():x=s.substring(m+d.length).trim()}else x=s.substring(m+d.length).trim();return x.replace(/^[:ï¼š\n\(\)ï¼ˆï¼‰]+/,"").trim()},o=l.details,n=i(o,"1. æ ¸å¿ƒç»“è®º","2. å…³é”®ä¼˜åŠ¿åˆ†æ")||"æš‚æ— ç»“è®º",t=i(o,"2. å…³é”®ä¼˜åŠ¿åˆ†æ","3. æ½œåœ¨é›·åŒºé¢„è­¦"),r=i(o,"3. æ½œåœ¨é›·åŒºé¢„è­¦","4. é•¿æœŸç›¸å¤„å»ºè®®"),u=i(o,"4. é•¿æœŸç›¸å¤„å»ºè®®"),a=s=>s?e.jsx("ul",{className:"space-y-3",children:s.split(`
`).map((d,b)=>{const m=d.trim();return!m||m.startsWith("---")?null:e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 mt-1.5 h-1.5 w-1.5 flex-shrink-0 rounded-full bg-current opacity-60"}),e.jsx("span",{className:"text-sm leading-relaxed",children:m.replace(/^- /,"").replace(/^\d+\. /,"")})]},b)})}):e.jsx("p",{className:"text-gray-500 italic",children:"æš‚æ— æ˜¾è‘—æ•°æ®"});return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 sm:p-10 bg-white border border-gray-200 rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 text-xs font-mono text-gray-400 border-b border-gray-100 pb-4",children:[e.jsxs("div",{children:["å‘èµ·è€…(A): ",h||"Unknown"]}),e.jsxs("div",{children:["åŒ¹é…è€…(B): ",c||"Unknown"]})]}),e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 mb-2",children:"çµé­‚å¥‘åˆåº¦åˆ†ææŠ¥å‘Š"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"åŸºäº 50 ç»´åº¦æ·±åº¦æ¯”å¯¹ç®—æ³•"}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-8 relative",children:e.jsxs("div",{className:"relative w-40 h-40 flex items-center justify-center",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"#f3f4f6",strokeWidth:"12",fill:"transparent"}),e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"currentColor",strokeWidth:"12",fill:"transparent",strokeDasharray:440,strokeDashoffset:440-440*l.compatibilityScore/100,className:"text-black transition-all duration-1000 ease-out",strokeLinecap:"round"})]}),e.jsxs("div",{className:"absolute flex flex-col items-center",children:[e.jsxs("span",{className:"text-4xl font-black tracking-tighter",children:[l.compatibilityScore,"%"]}),e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mt-1",children:"Match"})]})]})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-900 text-white p-8 rounded-xl shadow-lg transform hover:scale-[1.01] transition-transform",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ğŸ’¡"})," æ ¸å¿ƒç»“è®º"]}),e.jsx("p",{className:"text-lg leading-relaxed font-medium opacity-90",children:n})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-green-50 p-6 rounded-xl border border-green-100",children:[e.jsxs("h3",{className:"text-green-800 font-bold mb-4 flex items-center",children:[e.jsx("span",{className:"bg-green-200 text-green-800 p-1 rounded mr-2 text-xs",children:"MATCH"}),"å…³é”®ä¼˜åŠ¿"]}),e.jsx("div",{className:"text-green-900",children:a(t)})]}),e.jsxs("div",{className:"bg-red-50 p-6 rounded-xl border border-red-100",children:[e.jsxs("h3",{className:"text-red-800 font-bold mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-200 text-red-800 p-1 rounded mr-2 text-xs",children:"CONFLICT"}),"æ½œåœ¨é›·åŒº"]}),e.jsx("div",{className:"text-red-900",children:a(r)})]})]}),e.jsxs("div",{className:"bg-blue-50 p-8 rounded-xl border border-blue-100",children:[e.jsx("h3",{className:"text-blue-900 font-bold mb-4",children:"ğŸ”® é•¿æœŸç›¸å¤„å»ºè®®"}),e.jsx("div",{className:"text-blue-800 leading-relaxed",children:a(u)})]})]}),e.jsx("div",{className:"mt-12 text-center",children:e.jsx("button",{onClick:()=>window.location.href="/",className:"px-8 py-3 bg-white border-2 border-black text-black font-bold rounded-lg hover:bg-gray-50 transition-colors",children:"è¿”å›é¦–é¡µ"})})]})}const H=(l,h)=>{const c=w(l,h),i=v.map((o,n)=>{const t=l.answers[n],r=h.answers[n],u=o.options.find(s=>s.value===t),a=o.options.find(s=>s.value===r);return{id:o.id,dimension:o.dimension,question:o.text,A_answer:t,B_answer:r,A_label:u?.label||"N/A",B_label:a?.label||"N/A",difference:Math.abs(t-r)}});return{hostProfile:l,guestProfile:h,matchScore:c,comparisonMatrix:i}},I=l=>{const{matchScore:h,comparisonMatrix:c}=l,i=c.filter(t=>t.difference<=1),o=c.filter(t=>t.difference>=3);let n=`ä½ æ˜¯ä¸€ä½é¡¶å°–çš„ã€ä»¥æ•°æ®é©±åŠ¨çš„â€œå…³ç³»ç¤¾ä¼šå­¦å®¶â€ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸¤ä¸ªäººçš„50ä¸ªç»´åº¦é—®å·ç»“æœï¼Œç”Ÿæˆä¸€ä»½å®¢è§‚ã€çŠ€åˆ©ã€ç»“æ„åŒ–çš„ç›¸æ€§åˆ†ææŠ¥å‘Šã€‚ä¸¤äººåŸºç¡€åŒ¹é…åº¦ä¸º ${h}%ã€‚è¯·ä»ä¸‰ä¸ªç»´åº¦ï¼ˆä¼˜åŠ¿ã€é›·åŒºã€é•¿æœŸå»ºè®®ï¼‰åˆ†æï¼Œå¹¶ä½¿ç”¨ä¸­æ–‡åˆ†ç‚¹ä½œç­”ã€‚`;return n+=`

--- ä¼˜åŠ¿ç»´åº¦ï¼ˆDifference <= 1ï¼‰ï¼šä¸¤äººå¤©ç„¶å¥‘åˆç‚¹ ---`,i.slice(0,5).forEach(t=>{n+=`
- [${t.dimension}]: Q.${t.id} (${t.question}) ä¸¤äººç­”æ¡ˆå‡ ä¹ä¸€è‡´ï¼ŒA: ${t.A_label}, B: ${t.B_label}ã€‚`}),n+=`

--- æ ¸å¿ƒé›·åŒºï¼ˆDifference >= 3ï¼‰ï¼šæœªæ¥æ½œåœ¨çš„å†²çªçˆ†å‘ç‚¹ ---`,o.slice(0,5).forEach(t=>{n+=`
- [${t.dimension}]: Q.${t.id} (${t.question}) å·®å¼‚å·¨å¤§ (A:${t.A_label} vs B:${t.B_label})ã€‚è¿™æ˜¯ç¡¬æ€§çŸ›ç›¾ï¼Œéœ€è¦æ·±å…¥å…³æ³¨ã€‚`}),n+=`

--- ç»´åº¦æ€»ç»“ ---`,n+=`

è¯·æ ¹æ®ä¸Šè¿°æ•°æ®å’Œé£æ ¼è¦æ±‚ï¼Œç”ŸæˆæŠ¥å‘Šçš„æœ€ç»ˆå†…å®¹ï¼ŒæŠ¥å‘Šåº”åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š
`,n+=`1. æ ¸å¿ƒç»“è®ºï¼ˆä¸€å¥è¯æ€»ç»“ï¼Œç›´æŒ‡æœ¬è´¨ï¼‰
`,n+=`2. å…³é”®ä¼˜åŠ¿åˆ†æï¼ˆåˆ—ç‚¹é˜è¿°ï¼‰
`,n+=`3. æ½œåœ¨é›·åŒºé¢„è­¦ï¼ˆåˆ—ç‚¹é˜è¿°ï¼Œè¯­è¨€è¦çŠ€åˆ©ï¼‰
`,n+=`4. é•¿æœŸç›¸å¤„å»ºè®®ï¼ˆç»™å‡ºå¯æ“ä½œçš„ç­–ç•¥ï¼‰
`,n},$=async(l,h,c)=>{const i=H(l,h),o=I(i),n="/api/analyze";try{const t=async(a,s,d=3,b=1e3)=>{try{const m=await fetch(a,s);return m.ok?m:[429,500,502,503,504].includes(m.status)&&d>0?(c&&c(4-d),await new Promise(x=>setTimeout(x,b)),t(a,s,d-1,b*2)):m}catch(m){if(d>0)return c&&c(4-d),await new Promise(x=>setTimeout(x,b)),t(a,s,d-1,b*2);throw m}},r=await t(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:o})});if(!r.ok)throw new Error("AI Analysis request failed");const u=await r.json();return{compatibilityScore:i.matchScore,summary:`åŸºäºæ•°æ®çš„çµé­‚å¥‘åˆåº¦ï¼š${i.matchScore}%`,details:u.reportText}}catch(t){return console.error("AI Analysis Error:",t),{compatibilityScore:i.matchScore,summary:`åŸºäºæ•°æ®çš„çµé­‚å¥‘åˆåº¦ï¼š${i.matchScore}% (ç¦»çº¿æ¨¡å¼)`,details:`[ç³»ç»Ÿæç¤ºï¼šAI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œä»¥ä¸‹æ˜¯åŸºäºåŸå§‹æ•°æ®çš„åˆ†æé¢„è§ˆ]

${o}`}}};function _(){const[l,h]=p.useState(null),[c,i]=p.useState(null),[o,n]=p.useState(null),[t,r]=p.useState(!1),[u,a]=p.useState(null),[s,d]=p.useState(0);p.useEffect(()=>{const f=new URLSearchParams(window.location.search).get("host");f&&(g(f)?h(f):a("æ— æ•ˆçš„é‚€è¯·é“¾æ¥æˆ– Soul Hash å·²æŸåã€‚"))},[]);const b=x=>{g(x)?(h(x),window.history.pushState({},"",`/match?host=${x}`),a(null)):a("æ— æ•ˆçš„ Soul Hashï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚")},m=async x=>{i(x),r(!0),a(null),d(0);try{if(l){const f=g(l),j=g(x);if(f&&j){const y=await $(f,j,N=>d(N));n(y)}else a("è§£æ Soul Profile å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚")}}catch(f){console.error(f),a("åˆ†æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚")}finally{r(!1),d(0)}};return o?e.jsx(k,{result:o,hostInfo:l?l.substring(0,8)+"...":void 0,guestInfo:c?c.substring(0,8)+"...":void 0}):t?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-black mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"æ­£åœ¨è¿›è¡Œçµé­‚å…±é¸£åˆ†æ..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"AI æ­£åœ¨å¯¹æ¯”ä½ ä»¬çš„ 50 ä¸ªç»´åº¦æ•°æ®"}),s>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 text-yellow-800 rounded-lg text-sm animate-pulse border border-yellow-200",children:["âš ï¸ å¯¹æ–¹æœåŠ¡å“åº”ç¼“æ…¢ï¼Œæ­£åœ¨å°è¯•ç¬¬ ",s," æ¬¡é‡è¿..."]})]}):u?e.jsxs("div",{className:"max-w-md mx-auto mt-10 p-6 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"å‡ºé”™äº†"}),e.jsx("p",{className:"text-red-600 mb-4",children:u}),e.jsx("button",{onClick:()=>window.location.href="/match",className:"px-4 py-2 bg-white border border-red-300 text-red-700 rounded hover:bg-red-50 transition-colors",children:"è¿”å›é‡è¯•"})]}):l?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center bg-gray-50 p-6 rounded-xl border border-gray-100",children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-black text-white rounded-full text-xs font-mono mb-3",children:"åŒ¹é…æ¨¡å¼ (MATCHING MODE)"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"å¯¹æ–¹å·²å°±ä½ï¼Œè¯·å®Œæˆä½ çš„ Soul Profile"}),e.jsxs("p",{className:"text-gray-500 text-sm font-mono",children:["ç›®æ ‡ Hash: ",l.substring(0,12),"..."]})]}),e.jsx(S,{onComplete:m})]}):e.jsx(A,{onMatch:b})}export{_ as default};
