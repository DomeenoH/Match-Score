import{j as e,d as f}from"./codec.BvyRAB0w.js";import{r as i}from"./index.CVf8TyFT.js";import{Q as N}from"./Questionnaire.Dw5uOGqh.js";import{A as v,f as S}from"./AnalysisReport.DiI71HLu.js";function H({onMatch:n}){const[h,c]=i.useState(""),m=s=>{const t=s.match(/[?&]host=([a-zA-Z0-9\-_]+)/);if(t&&t[1])return t[1];const r=s.split(/[\s\n\r]+/).filter(l=>/^[a-zA-Z0-9\-_]{10,}$/.test(l));if(r.length>0){const l=r.filter(u=>!u.startsWith("http"));return l.length>0?l[l.length-1]:r[r.length-1]}return s.trim()},x=s=>{s.preventDefault();const t=h.trim();if(t){const a=m(t);n(a)}},p=s=>{s.preventDefault();const t=s.clipboardData.getData("text");c(t);const a=m(t);a!==t&&a.length>0?c(a):c(t)};return e.jsxs("div",{className:"max-w-md mx-auto p-8 bg-white rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"输入对方的 Soul Hash"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"粘贴邀请函、链接或直接输入 Hash 编码"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hash-input",className:"sr-only",children:"Soul Hash"}),e.jsx("textarea",{id:"hash-input",value:h,onChange:s=>c(s.target.value),onPaste:p,placeholder:"在此粘贴...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent transition-all min-h-[120px] text-sm font-mono resize-none",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full px-6 py-4 bg-black text-white font-bold rounded-xl hover:bg-gray-800 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:"开始匹配分析"})]})]})}function P(){const[n,h]=i.useState(null),[c,m]=i.useState(null),[x,p]=i.useState(null),[s,t]=i.useState(!1),[a,r]=i.useState(null),[l,u]=i.useState(0);i.useEffect(()=>{const o=new URLSearchParams(window.location.search).get("host");o&&(f(o)?h(o):r("无效的邀请链接或 Soul Hash 已损坏。"))},[]);const g=d=>{f(d)?(h(d),window.history.pushState({},"",`/match?host=${d}`),r(null)):r("无效的 Soul Hash，请检查后重试。")},y=async d=>{m(d),t(!0),r(null),u(0);try{if(n){const o=f(n),b=f(d);if(o&&b){const j=await S(o,b,w=>u(w));p(j)}else r("解析 Soul Profile 失败，请重试。")}}catch(o){console.error(o),r("分析过程中发生错误，请稍后重试。")}finally{t(!1),u(0)}};return x?e.jsx(v,{result:x,hostInfo:n?n.substring(0,8)+"...":void 0,guestInfo:c?c.substring(0,8)+"...":void 0}):s?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-black mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"正在进行灵魂共鸣分析..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"AI 正在对比你们的 50 个维度数据"}),l>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 text-yellow-800 rounded-lg text-sm animate-pulse border border-yellow-200",children:["AI 服务连接不稳定，正在进行第 ",l," 次重试..."]})]}):a?e.jsxs("div",{className:"max-w-md mx-auto mt-10 p-6 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"出错了"}),e.jsx("p",{className:"text-red-600 mb-4",children:a}),e.jsx("button",{onClick:()=>window.location.href="/match",className:"px-4 py-2 bg-white border border-red-300 text-red-700 rounded hover:bg-red-50 transition-colors",children:"返回重试"})]}):n?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center bg-gray-50 p-6 rounded-xl border border-gray-100",children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-black text-white rounded-full text-xs font-mono mb-3",children:"匹配模式 (MATCHING MODE)"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"对方已就位，请完成你的 Soul Profile"}),e.jsxs("p",{className:"text-gray-500 text-sm font-mono",children:["目标 Hash: ",n.substring(0,12),"..."]})]}),e.jsx(N,{onComplete:y})]}):e.jsx(H,{onMatch:g})}export{P as default};
